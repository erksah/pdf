<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ“„ PDF Multi-Tool Working Thumbnails</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<style>
body { font-family: Arial,sans-serif; background:#f0f0f0; margin:0; padding:10px;}
h1 { text-align:center; color:#333;}
.tool-box { max-width:1200px; margin:auto; background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
input, button { margin:10px 5px; padding:10px; border-radius:5px; border:none; font-size:14px;}
button { background:#007bff; color:#fff; cursor:pointer; transition:0.2s;}
button:hover { background:#0056b3;}
button:disabled { background:#aaa; cursor:not-allowed;}
#pageList { display:flex; flex-wrap:wrap; justify-content:center; max-height:300px; overflow-y:auto;}
.page-thumb { background:#fff; padding:5px; margin:5px; border-radius:5px; width:100px; cursor:pointer; position:relative; display:flex; flex-direction:column; align-items:center; box-shadow:0 0 5px rgba(0,0,0,0.2);}
.page-thumb img, .page-thumb canvas { width:100%; border-radius:5px; display:block; background:#eee; object-fit:contain;}
.page-number { margin-top:3px; font-size:12px; font-weight:bold; color:#333;}
.delete-btn { position:absolute; top:2px; right:2px; width:18px; height:18px; border-radius:50%; background:red; color:#fff; border:none; font-weight:bold; cursor:pointer; line-height:16px;}
#previewContainer { margin-top:15px; text-align:center;}
#previewContainer img, #previewContainer canvas { max-width:95%; max-height:400px; border:2px solid #007bff; border-radius:8px; object-fit:contain;}
@media(max-width:768px){ .page-thumb{width:70px;} .page-number{font-size:10px;} #previewContainer img,#previewContainer canvas{max-height:250px;} input,button{font-size:12px; padding:8px;} }
@media(max-width:480px){ .page-thumb{width:60px;} }
</style>
</head>
<body>
<h1>ðŸ“„ PDF Multi-Tool</h1>
<div class="tool-box">
<input type="file" id="fileInput" multiple accept="application/pdf,image/*">
<button id="exportBtn" onclick="exportPDF()" disabled>ðŸ’¾ Export Final PDF</button>
<div id="pageList"></div>
<div id="previewContainer"></div>
</div>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js";

let workspacePages=[];
const exportBtn=document.getElementById("exportBtn");
const previewContainer=document.getElementById("previewContainer");
const fileInput=document.getElementById("fileInput");

// File input
fileInput.addEventListener("change", async (e)=>{
  const files=e.target.files;
  for(const file of files){
    if(file.type.startsWith("image/")) await addImage(file);
    else if(file.type==="application/pdf") await addPDF(file);
  }
  renderPageList();
  exportBtn.disabled=workspacePages.length===0;
});

async function addImage(file){
  const dataUrl=await new Promise((res,rej)=>{
    const reader=new FileReader();
    reader.onload=()=>res(reader.result);
    reader.onerror=rej;
    reader.readAsDataURL(file);
  });
  workspacePages.push({type:"image",data:dataUrl});
}

async function addPDF(file){
  const buffer=await file.arrayBuffer();
  const pdfDoc=await PDFLib.PDFDocument.load(buffer);
  pdfDoc.getPageIndices().forEach(i=>{
    workspacePages.push({type:"pdf",source:pdfDoc,index:i,buffer});
  });
}

function renderPageList(){
  const container=document.getElementById("pageList");
  container.innerHTML="";
  workspacePages.forEach((page,i)=>{
    const div=document.createElement("div");
    div.className="page-thumb";

    // Delete button
    const delBtn=document.createElement("button");
    delBtn.className="delete-btn"; delBtn.textContent="Ã—";
    delBtn.onclick=()=>{ workspacePages.splice(i,1); renderPageList(); previewContainer.innerHTML=""; exportBtn.disabled=workspacePages.length===0; };
    div.appendChild(delBtn);

    // Thumbnail
    if(page.type==="image"){
      const img=document.createElement("img"); img.src=page.data; div.appendChild(img);
      div.onclick=()=>showPreview(page);
    } else if(page.type==="pdf"){
      const canvas=document.createElement("canvas"); div.appendChild(canvas);
      renderPDFThumbnail(page.buffer,page.index,canvas);
      div.onclick=()=>showPreview(page);
    }

    const num=document.createElement("div"); num.className="page-number"; num.textContent=`Page ${i+1}`;
    div.appendChild(num);
    container.appendChild(div);
  });
}

function showPreview(page){
  previewContainer.innerHTML="";
  if(page.type==="image"){
    const img=document.createElement("img"); img.src=page.data; previewContainer.appendChild(img);
  } else if(page.type==="pdf"){
    const canvas=document.createElement("canvas"); previewContainer.appendChild(canvas);
    renderPDFPreview(page.buffer,page.index,canvas);
  }
}

async function renderPDFThumbnail(buffer,pageIndex,canvas){
  const pdf=await pdfjsLib.getDocument({data:buffer}).promise;
  const page=await pdf.getPage(pageIndex+1);
  const scale=Math.min(100/page.getViewport({scale:1}).width,100/page.getViewport({scale:1}).height);
  const viewport=page.getViewport({scale:scale});
  canvas.width=viewport.width;
  canvas.height=viewport.height;
  const ctx=canvas.getContext("2d");
  await page.render({canvasContext:ctx,viewport}).promise;
}

async function renderPDFPreview(buffer,pageIndex,canvas){
  const pdf=await pdfjsLib.getDocument({data:buffer}).promise;
  const page=await pdf.getPage(pageIndex+1);
  const viewport=page.getViewport({scale:1.5});
  canvas.width=viewport.width;
  canvas.height=viewport.height;
  const ctx=canvas.getContext("2d");
  await page.render({canvasContext:ctx,viewport}).promise;
}

async function exportPDF(){
  if(workspacePages.length===0) return;
  exportBtn.disabled=true; fileInput.disabled=true;
  const pdfDoc=await PDFLib.PDFDocument.create();
  for(const page of workspacePages){
    if(page.type==="pdf"){
      const [copied]=await pdfDoc.copyPages(page.source,[page.index]);
      pdfDoc.addPage(copied);
    } else if(page.type==="image"){
      const jpg=await pdfDoc.embedJpg(page.data);
      const p=pdfDoc.addPage(); const {width,height}=p.getSize();
      p.drawImage(jpg,{x:0,y:0,width,height});
    }
  }
  const bytes=await pdfDoc.save();
  const blob=new Blob([bytes],{type:"application/pdf"});
  const link=document.createElement("a"); link.href=URL.createObjectURL(blob); link.download="final_output.pdf"; link.click();
  exportBtn.disabled=false; fileInput.disabled=false;
}
</script>
</body>
</html>
